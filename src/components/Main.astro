---
import Body from "./Body.astro";
import Circles from "./Circles.svelte";
import ThemeSwitcher from "./ThemeSwitcher.astro";

const animDuration = "0.4s";

const anim = {
  old: {
    name: "blur-out",
    duration: animDuration,
  },
  new: {
    name: "blur-in",
    duration: animDuration,
  },
};

const customTransition = {
  forwards: anim,
  backwards: anim,
};

const { isPost } = Astro.props;
---

<Body>
  {!isPost && <Circles client:load />}

  <main
    class={`prose dark:prose-invert md:p-8 sm:p-6 p-4
    ${isPost ? "max-w-[70ch]!" : "max-w-[65ch]!" /* 65ch is prose default */}`}
    transition:animate={customTransition}
  >
    <slot />

    <hr />

    <div class="flex justify-between gap-3">
      <a href="https://github.com/f0e/site">site source code</a>
      <ThemeSwitcher />
    </div>
  </main>
</Body>

<style>
  :root {
    --anim-distance: 20px;
    --blur-amount: 8px;
  }

  @keyframes blur-in {
    from {
      opacity: 0;
      filter: blur(var(--blur-amount));
    }
  }

  @keyframes blur-out {
    to {
      opacity: 0;
      filter: blur(var(--blur-amount));
    }
  }
</style>

<script is:inline>
  // @TODO: is there a better, more natively Astro way of doing this?

  const images = document.querySelectorAll(".fade-in");

  images.forEach((img) => {
    if (!img.complete || img.naturalWidth === 0) {
      // not already loaded, fade in
      img.classList.add("opacity-0");

      img.addEventListener("load", () => {
        img.classList.add("transition-opacity", "duration-300");
        img.classList.remove("opacity-0");
      });
    }
  });
</script>
