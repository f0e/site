---
import type { MarkdownInstance } from "astro";
import { type Props as PostProps } from "@layouts/PostLayout.astro";

import { dateToNiceString } from "@utils/dates";

type PostPage = MarkdownInstance<PostProps["frontmatter"]>;

const { filter } = Astro.props;

const posts = (
  Object.values(
    import.meta.glob("@pages/posts/**/*.mdx", { eager: true })
  ) as PostPage[]
)
  .filter((post) => !filter.includes(post.frontmatter.title))
  .sort(
    (a, b) => +new Date(b.frontmatter.date) - +new Date(a.frontmatter.date)
  );
---

<ul>
  {
    posts.map((post) => (
      <li>
        <a href={post.url}>{post.frontmatter.title}</a>
        {post.frontmatter.date &&
          ` â€” ${dateToNiceString(new Date(post.frontmatter.date))}`}
      </li>
    ))
  }
</ul>
